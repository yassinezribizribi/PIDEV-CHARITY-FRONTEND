<app-admin-navbar></app-admin-navbar>

<!-- Hero Section -->
<section class="bg-half-170 d-table w-100" style="background: url('assets/images/hero/pages.jpg') center;">
  <div class="bg-overlay bg-gradient-overlay"></div>
  <div class="container">
    <div class="row mt-5 justify-content-center">
      <div class="col-12 text-center">
        <h5 class="heading fw-semibold text-white title-dark">Management</h5>
      </div>
    </div>
    <div class="position-middle-bottom">
      <nav aria-label="breadcrumb" class="d-block">
        <ul class="breadcrumb breadcrumb-muted mb-0 p-0">
          <li class="breadcrumb-item"><a [routerLink]="'/admin'">Admin</a></li>
          <li class="breadcrumb-item active" aria-current="page">Training</li>
        </ul>
      </nav>
    </div>
  </div>
</section>

<div class="position-relative">
  <div class="shape overflow-hidden text-white">
    <svg viewBox="0 0 2880 48" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 48H1437.5H2880V0H2160C1442.5 52 720 0 720 0H0V48Z" fill="currentColor"></path>
    </svg>
  </div>
</div>

<section class="section py-5">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12">
        <!-- Add/Edit Training Form -->
        <div *ngIf="openajouter" class="card border-0 shadow-sm mb-4">
          <div class="card-header bg-transparent">
            <h5 class="mb-0">{{ isEditMode ? 'Edit Training' : 'Add Training' }}</h5>
          </div>
          <div class="card-body">
            <form [formGroup]="trainingForm" (ngSubmit)="onSubmit()">
              <div class="form-group mb-2">
                <label for="trainingName">Training Name</label>
                <input id="trainingName" formControlName="trainingName" type="text" class="form-control" />
                <div *ngIf="trainingForm.get('trainingName')?.touched && trainingForm.get('trainingName')?.invalid" class="text-danger">
                  <small *ngIf="trainingForm.get('trainingName')?.errors?.['required']">This field is required.</small>
                  <small *ngIf="trainingForm.get('trainingName')?.errors?.['minlength']">Minimum 3 characters.</small>
                </div>
              </div>

              <div class="form-group mb-2">
                <label for="description">Description</label>
                <textarea id="description" formControlName="description" class="form-control"></textarea>
                <div *ngIf="trainingForm.get('description')?.touched && trainingForm.get('description')?.invalid" class="text-danger">
                  <small *ngIf="trainingForm.get('description')?.errors?.['required']">This field is required.</small>
                  <small *ngIf="trainingForm.get('description')?.errors?.['minlength']">Minimum 10 characters.</small>
                </div>
              </div>

              <div class="form-group mb-2">
                <label for="duration">Duration (in days)</label>
                <input id="duration" formControlName="duration" type="number" class="form-control" />
                <div *ngIf="trainingForm.get('duration')?.touched && trainingForm.get('duration')?.invalid" class="text-danger">
                  <small *ngIf="trainingForm.get('duration')?.errors?.['required']">This field is required.</small>
                  <small *ngIf="trainingForm.get('duration')?.errors?.['min']">Duration must be at least 1 day.</small>
                </div>
              </div>

              <div class="form-group mb-2">
                <label for="capacity">Capacity</label>
                <input id="capacity" formControlName="capacity" type="number" class="form-control" />
                <div *ngIf="trainingForm.get('capacity')?.touched && trainingForm.get('capacity')?.invalid" class="text-danger">
                  <small *ngIf="trainingForm.get('capacity')?.errors?.['required']">This field is required.</small>
                  <small *ngIf="trainingForm.get('capacity')?.errors?.['min']">Minimum 1 participant.</small>
                </div>
              </div>

              <div class="form-group mb-2">
                <label for="level">Level</label>
                <select id="level" formControlName="level" class="form-control">
                  <option value="">-- Select --</option>
                  <option value="INTERMIDIATE">INTERMEDIATE</option>
                  <option value="BEGINNER">BEGINNER</option>
                  <option value="PROFESSIONAL">PROFESSIONAL</option>
                </select>
                <div *ngIf="trainingForm.get('level')?.touched && trainingForm.get('level')?.invalid" class="text-danger">
                  <small>This field is required.</small>
                </div>
              </div>

              <div class="form-group mb-2">
                <label for="type">Training Type</label>
                <select id="type" formControlName="type" class="form-control">
                  <option value="">-- Select --</option>
                  <option value="SKILLTRAINING">SKILL TRAINING</option>
                  <option value="COURSE">COURSE</option>
                </select>
                <div *ngIf="trainingForm.get('type')?.touched && trainingForm.get('type')?.invalid" class="text-danger">
                  <small>This field is required.</small>
                </div>
              </div>

              <div class="form-group mb-2">
                <label for="sessionDate">Session Date</label>
                <input id="sessionDate" formControlName="sessionDate" type="date" class="form-control" />
                <div *ngIf="trainingForm.get('sessionDate')?.touched && trainingForm.get('sessionDate')?.invalid" class="text-danger">
                  <small>This field is required.</small>
                </div>
              </div>

              <button type="button" (click)="close()" class="btn btn-secondary me-2">
                Close
              </button>

              <button type="submit" [disabled]="trainingForm.invalid" class="btn btn-primary">
                {{ isEditMode ? 'Update' : 'Add' }}
              </button>
            </form>
          </div>
        </div>


            <!-- Add Button -->
            <div class="text-end mb-3">
              <button class="btn btn-primary" (click)="openajouter=true">
                Add Training
              </button>
            </div>

            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th scope="col">Training Name</th>
                    <th scope="col">Description</th>
                    <th scope="col">Duration</th>
                    <th scope="col">Capacity</th>
                    <th scope="col">Level</th>
                    <th scope="col">Type</th>
                    <th scope="col">Session Date</th>
                    <th scope="col">Actions</th>
                  </tr>
                </thead>
                <tbody *ngFor="let training of trainings">
                  <tr>
                    <td>{{ training.trainingName }}</td>
                    <td>{{ training.description }}</td>
                    <td>{{ training.duration }}</td>
                    <td>{{ training.capacity }}</td>
                    <td>{{ training.level }}</td>
                    <td>{{ training.type }}</td>
                    <td>{{ training.sessionDate | date:'yyyy-MM-dd' }}</td>
                    <td>
                      <button class="btn btn-warning btn-sm me-1" (click)="editTraining(training)">Edit</button>
                      <button class="btn btn-danger btn-sm me-1" (click)="deleteTraining(training.idTraining)">Delete</button>
                      <button class="btn btn-info btn-sm" (click)="toggleSubscribers(training.idTraining)">
                        {{ selectedTrainingId === training.idTraining ? 'Hide Subscribers' : 'View Subscribers' }}
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="selectedTrainingId === training.idTraining">
                    <td colspan="8">
                      <ul *ngIf="training.subscribers?.length > 0; else noSubscribers">
                        <li *ngFor="let subscriber of training.subscribers">
                          {{ subscriber.name }} ({{ subscriber.email }})
                          <button class="btn btn-success btn-sm" (click)="downloadCertificate(training.idTraining!, subscriber.idUser!)">
                            <i class="mdi mdi-download"></i> Download Certificate
                          </button>
                        </li>
                      </ul>
                      <ng-template #noSubscribers>
                        <p>No subscribers for this training.</p>
                      </ng-template>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Success Modal for Training Deletion -->
<div class="modal fade" id="trainingDeleteModal" tabindex="-1" aria-labelledby="trainingDeleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-3 shadow-lg border-0">
      <div class="modal-header border-0" style="background: #f8f9fa;">
        <h5 class="modal-title fw-semibold" id="trainingDeleteModalLabel">Success</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <p class="text-success">Training deleted successfully.</p>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-primary rounded-pill" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Error Modal for Training Deletion -->
<div class="modal fade" id="trainingDeleteErrorModal" tabindex="-1" aria-labelledby="trainingDeleteErrorModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-3 shadow-lg border-0">
      <div class="modal-header border-0" style="background: #f8f9fa;">
        <h5 class="modal-title fw-semibold" id="trainingDeleteErrorModalLabel">Error</h5>
        <button type="type" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <p class="text-danger">An error occurred while deleting the training.</p>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-primary rounded-pill" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Confirmation Modal for Training Deletion -->
<div class="modal fade" id="trainingDeleteConfirmModal" tabindex="-1" aria-labelledby="trainingDeleteConfirmModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-3 shadow-lg border-0">
      <div class="modal-header border-0" style="background: #f8f9fa;">
        <h5 class="modal-title fw-semibold" id="trainingDeleteConfirmModalLabel">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <p>Are you sure you want to delete this training?</p>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger rounded-pill confirm-delete-btn">Confirm</button>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>
<app-scroll-to-top></app-scroll-to-top>